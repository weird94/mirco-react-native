import e,{Suspense as t}from"react";import*as n from"react-native";import{View as r}from"react-native";import o from"react-navigation";import i from"react-navigation-stack";function u(t){if("REACT"==t)return e;if("REACT_NATIVE"==t)return n;if("REACT_NAVIGATION"==t)return o;if("REACT_NAVIGATION_STACK"==t)return i;throw"require unsupported external module: ".concat(t)}function a(e,t){return t(e).then((function(e){return e.text()})).then((function(e){var t={};return new Function("exports","require",e)(t,u),t.__esModule?t.default:t}))}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}var y=function(){};function E(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.Loading,o=n.ErrorTips,i=n.trackRenderError,u=void 0===i?y:i,f=n.injectFetch;if(!r)throw"invailed options, prop `Loading` is required";if(!o)throw"invailed options, prop `ErrorTips` is required";return(function(n){function i(e){var t;return c(this,i),l(d(t=m(this,v(i).call(this,e))),"handleRetry",(function(){t.setState({error:!1})})),l(d(t),"handleRefresh",(function(){t.buildComponent(),t.setState({refreshTag:Date.now()})})),t.state={error:!1,refreshTag:0},t.focusEvent=null,t.buildComponent(),t}return p(i,e.Component),s(i,[{key:"buildComponent",value:function(){var t=this.props.navigation.getParam("url");this.RemoteComponent=e.lazy((function(){return a(t,f||fetch)}))}},{key:"addFocusEvent",value:function(){var e=this.props.navigation;this.focusEvent=e.addEventListener("didFocus",this.handleFocus)}},{key:"removeFocusEvent",value:function(){this.focusEvent&&(this.focusEvent.remove(),this.focusEvent=null)}},{key:"handleFocus",value:function(){var e=this.props,t=e.navigation,n=e.onBackToTop;1===t.dangerouslyGetParent().routes.length&&"function"==typeof n&&n()}},{key:"componentDidCatch",value:function(e){u(e),this.setState({error:!0})}},{key:"componentDidMount",value:function(){this.addFocusEvent()}},{key:"componentWillUnmount",value:function(){this.removeFocusEvent()}},{key:"render",value:function(){var n=this.RemoteComponent,i=this.state,u=i.error,a=i.refreshTag;return u?e.createElement(o,{onRetry:this.handleRetry}):e.createElement(t,{key:a,fallback:e.createElement(r,null)},e.createElement(n,this.props))}}]),i}())}var b=E({Loading:function(){return e.createElement(r,null)},ErrorTips:function(){return e.createElement(r,null)},trackRenderError:console.warn});export{b as RemoteComponentContainer,E as createContainer,a as loadRemoteComponent};
